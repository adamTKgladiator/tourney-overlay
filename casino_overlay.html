<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Speedrun Championship Overlay</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-bright: #FBF5B7;
            --felt: #004d26;
            --suit-red: #d40000;
            --suit-black: #1a1a1a;
            --suit-blue: #0066ff;
            --neon-cyan: #0ff;
            --royal-purple: #6a0dad;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background-color: #000;
            background-image: url('./Assets/casino_bg.png');
            background-size: cover;
            background-position: center;
            color: white;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header Marquee */
        .casino-header {
            height: 120px;
            background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.8) 20%, rgba(0, 0, 0, 0.8) 80%, transparent);
            border-bottom: 2px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .header-title {
            font-size: 4rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 6px;
            color: var(--gold-bright);
            text-shadow:
                0 0 10px rgba(212, 175, 55, 0.8),
                0 0 20px rgba(212, 175, 55, 0.4),
                0 0 40px rgba(212, 175, 55, 0.2);
            white-space: nowrap;
        }

        .round-info {
            position: absolute;
            right: 50px;
            background: var(--gold);
            color: #000;
            padding: 5px 20px;
            font-weight: 800;
            transform: skewX(-15deg);
            box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.3);
        }

        /* Match Meta (Game/Goal) */
        .match-meta-container {
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 10;
        }

        .glass-badge {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--gold);
            padding: 8px 25px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .glass-badge i {
            color: var(--gold);
        }

        /* Streams Layout */
        .streams-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            margin-top: 0px;
            /* Drag screens up */
        }

        .player-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 48%;
            /* Ensure they don't overlap */
        }

        .stream-container {
            width: 100%;
            aspect-ratio: 16/9;
            position: relative;
            background: #000;
            border: 6px solid var(--gold);
            box-shadow:
                0 0 30px rgba(212, 175, 55, 0.3),
                inset 0 0 20px rgba(0, 0, 0, 1);
            border-radius: 4px;
        }

        .stream-container::before {
            content: '';
            position: absolute;
            top: -12px;
            left: -12px;
            right: -12px;
            bottom: -12px;
            border: 2px solid rgba(212, 175, 55, 0.2);
            pointer-events: none;
        }

        .twitch-embed {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Player Cards (Names) */
        .player-nameplate {
            margin-top: 30px;
            width: 70%;
            height: 70px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .player-nameplate:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .player-name {
            color: #1a1a1a;
            font-size: 2rem;
            font-weight: 900;
            text-transform: uppercase;
        }

        /* Poker Suit Accents on Plates */
        .suit-accent {
            position: absolute;
            font-size: 1.5rem;
        }

        .suit-tl {
            top: 5px;
            left: 10px;
        }

        .suit-br {
            bottom: 5px;
            right: 10px;
            transform: rotate(180deg);
        }

        .p1-side .player-nameplate {
            background: linear-gradient(135deg, #fff 0%, #fff0f0 100%);
            border: 2px solid var(--suit-red);
            border-bottom: 5px solid var(--suit-red);
        }

        .p1-side .player-name {
            color: var(--suit-red);
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.05);
        }

        .p1-side .suit-accent {
            color: var(--suit-red);
            opacity: 0.8;
        }

        .p2-side .player-nameplate {
            background: linear-gradient(135deg, #fff 0%, #eef6ff 100%);
            border: 2px solid var(--suit-blue);
            border-bottom: 5px solid var(--suit-blue);
        }

        .p2-side .player-name {
            color: var(--suit-blue);
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.05);
        }

        .p2-side .suit-accent {
            color: var(--suit-blue);
            opacity: 0.8;
        }

        /* Watermarks */
        .p1-side .player-nameplate::after {
            content: '♥';
            position: absolute;
            font-size: 5rem;
            right: -10px;
            bottom: -20px;
            opacity: 0.1;
            color: var(--suit-red);
            pointer-events: none;
        }

        .p2-side .player-nameplate::after {
            content: '♠';
            position: absolute;
            font-size: 5rem;
            right: -10px;
            bottom: -20px;
            opacity: 0.1;
            color: var(--suit-blue);
            pointer-events: none;
        }

        /* Loading & Error */
        .overlay-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-size: 1.5rem;
        }

        .error-card {
            background: #fff;
            color: #000;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            border-top: 10px solid var(--suit-red);
        }

        .spinner {
            color: var(--gold);
            font-size: 4rem;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <!-- Loading State -->
    <div id="loadingOverlay" class="overlay-screen">
        <i class="fas fa-dice-d20 fa-spin spinner"></i>
        <span>Dealing the cards...</span>
    </div>

    <!-- Error State -->
    <div id="errorMessage" class="overlay-screen" style="display: none;">
        <div class="error-card">
            <i class="fas fa-exclamation-circle"
                style="font-size: 3rem; color: var(--suit-red); margin-bottom: 15px;"></i>
            <h2>BUSTED!</h2>
            <p id="errorText" style="margin: 15px 0;">No match found. Check your match ID.</p>
            <small style="color: #666;">Format: ?match_id=UUID</small>
        </div>
    </div>

    <!-- Casino Header -->
    <header class="casino-header">
        <div class="header-title" id="tournamentTitle">CASINO SPEEDRUN CHAMPIONSHIP</div>
        <div class="round-info" id="roundName">LUNAR DIVISION</div>
    </header>



    <!-- Main Content (Streams) -->
    <main class="streams-wrapper">
        <!-- Player 1 -->
        <div class="player-column p1-side">
            <div class="stream-container">
                <iframe class="twitch-embed" id="twitchFrame1"></iframe>
            </div>
            <div class="player-nameplate">
                <div class="suit-accent suit-tl">♥️</div>
                <div class="player-name" id="player1Name">PLAYER 1</div>
                <div class="suit-accent suit-br">♥️</div>
            </div>
        </div>

        <!-- Player 2 -->
        <div class="player-column p2-side">
            <div class="stream-container">
                <iframe class="twitch-embed" id="twitchFrame2"></iframe>
            </div>
            <div class="player-nameplate">
                <div class="suit-accent suit-tl">♠️</div>
                <div class="player-name" id="player2Name">PLAYER 2</div>
                <div class="suit-accent suit-br">♠️</div>
            </div>
        </div>
    </main>

    <script>
        const SUPABASE_URL = 'https://ofkzngjawgimpdwuycqd.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_A22ZrmtTDJYaHCI-HCCRjA_jYhTKJ-x';

        function getMatchId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('match_id') || params.get('id');
        }

        async function init() {
            const matchId = getMatchId();
            if (!matchId) return showError("No match ID found in URL.");

            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/match_details?id=eq.${matchId}`, {
                    headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
                });

                if (!response.ok) throw new Error("Database connection failed.");
                const data = await response.json();
                if (!data.length) throw new Error("Match not found.");

                updateOverlay(data[0]);
                document.getElementById('loadingOverlay').style.display = 'none';
            } catch (err) {
                showError(err.message);
            }
        }

        function updateOverlay(match) {
            document.getElementById('roundName').textContent = (match.round || 'MATCH').toUpperCase();

            document.getElementById('player1Name').textContent = (match.player1_display || match.player1_name || 'Player 1').toUpperCase();
            document.getElementById('player2Name').textContent = (match.player2_display || match.player2_name || 'Player 2').toUpperCase();

            const domain = window.location.hostname;
            if (match.player1_twitch) {
                document.getElementById('twitchFrame1').src = `https://player.twitch.tv/?channel=${match.player1_twitch}&parent=${domain}&autoplay=true&muted=true`;
            }
            if (match.player2_twitch) {
                document.getElementById('twitchFrame2').src = `https://player.twitch.tv/?channel=${match.player2_twitch}&parent=${domain}&autoplay=true&muted=true`;
            }
        }

        function showError(msg) {
            document.getElementById('errorText').textContent = msg;
            document.getElementById('errorMessage').style.display = 'flex';
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        window.onload = init;
    </script>
</body>

</html>